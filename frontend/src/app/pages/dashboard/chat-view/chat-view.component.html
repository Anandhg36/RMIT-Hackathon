<!-- SHOW LOADING -->
<div class="courses-shell" *ngIf="loading">
  <div class="empty-shell">
    <div class="empty-card">
      <p class="empty-main">Loading your courses…</p>
      <p class="empty-sub">Please wait while we pull data from Canvas / Supabase.</p>
    </div>
  </div>
</div>

<!-- SHOW ERROR -->
<div class="courses-shell" *ngIf="!loading && error">
  <div class="empty-shell">
    <div class="empty-card">
      <p class="empty-main">Couldn’t load courses</p>
      <p class="empty-sub">{{ error }}</p>
    </div>
  </div>
</div>

<!-- MAIN VIEW -->
<div class="courses-shell" *ngIf="!loading && !error && courses?.length; else emptyState">
  <!-- Title -->
  <h2 class="page-title">Your Courses</h2>

  <!-- COURSE PICKER BAR -->
<div class="course-bar-wrapper">
  <div class="course-bar">
    <!-- ACTIVE PILL -->
    <div
      class="course-bar__active-pill"
      [style.width.px]="TAB_WIDTH"
      [style.transform]="'translateX(' + ((selectedIndex ?? 0) * TAB_WIDTH) + 'px)'"
    ></div>

    <!-- TABS -->
    <button
      class="course-tab"
      *ngFor="let course of courses; let i = index"
      (click)="selectCourse(i)"
      [class.active]="selectedIndex === i"
      [style.width.px]="TAB_WIDTH"
      [attr.title]="course.name || ('Course ' + (i + 1))"
    >
      <span class="course-tab__label">
        {{ course.name || ('Course ' + (i + 1)) }}
      </span>
    </button>
  </div>
</div>


  <!-- INFO CARD for selected course -->
  <section class="details-card" *ngIf="currentCourse as cur">
  <!-- Toggle Theory / Practical -->
  <div class="mode-toggle">
    <button
      class="mode-btn"
      [class.active]="selectedSubTab === 'theory'"
      (click)="switchSubTab('theory')"
    >
      Theory
    </button>
    <button
      class="mode-btn"
      [class.active]="selectedSubTab === 'practical'"
      (click)="switchSubTab('practical')"
    >
      Practical
    </button>
  </div>

  <!-- DETAILS JUST FOR CURRENT TAB -->
  <div class="single-session-content">
    <!-- THEORY VIEW -->
    <ng-container *ngIf="selectedSubTab === 'theory'; else practicalBlock">
      <h3 class="pane-title">Theory Details</h3>

      <div class="info-row">
        <span class="label">Day:</span>
        <span class="value">{{ cur.theory?.day || '—' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Time:</span>
        <span class="value">{{ cur.theory?.time || '—' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Classroom:</span>
        <span class="value">{{ cur.theory?.classroom || '—' }}</span>
      </div>
    </ng-container>

    <!-- PRACTICAL VIEW -->
    <ng-template #practicalBlock>
      <h3 class="pane-title">Practical Details</h3>

      <div class="info-row">
        <span class="label">Day:</span>
        <span class="value">{{ cur.practical?.day || '—' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Time:</span>
        <span class="value">{{ cur.practical?.time || '—' }}</span>
      </div>

      <div class="info-row">
        <span class="label">Classroom:</span>
        <span class="value">{{ cur.practical?.classroom || '—' }}</span>
      </div>
    </ng-template>
  </div>
</section>


  <!-- STUDENT LIST -->
  <section class="students-card" *ngIf="currentCourse as cur">
    <div class="students-head">
      <h3 class="students-title">Students Enrolled in this Class</h3>
    </div>

    <div class="students-scroll">
      <!-- classmates for the active tab -->
      <div class="student-row" *ngFor="
          let student of (
            selectedSubTab === 'theory'
              ? cur.theory?.students
              : cur.practical?.students
          ) || []
        ">
        <div class="student-meta">
          <div class="avatar-circle">
            <span class="avatar-initial">
              {{ student?.name ? student.name.charAt(0) : '?' }}
            </span>
          </div>
          <span class="student-name">{{ student?.name }}</span>
        </div>

        <button class="invite-btn">Invite</button>
      </div>

      <!-- fallback row if no classmates in this session -->
      <div class="student-row empty-row" *ngIf="
          (
            selectedSubTab === 'theory'
              ? (cur.theory?.students?.length || 0)
              : (cur.practical?.students?.length || 0)
          ) === 0
        ">
        <div class="student-meta">
          <span class="student-name">
            No classmates found yet for this session
          </span>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- EMPTY STATE WHEN NO COURSES -->
<ng-template #emptyState>
  <div class="empty-shell">
    <div class="empty-card">
      <p class="empty-main">No courses yet</p>
      <p class="empty-sub">
        Add your timetable so we can match classmates and show session info.
      </p>
    </div>
  </div>
</ng-template>